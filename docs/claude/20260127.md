# 2026-01-27 作業記録

## 本日の決定事項

### 認証・DB

- 認証: Google ログイン (NextAuth.js)
- DB: Turso (SQLite 互換)
- プライバシーポリシー: 最低限のもの作って `/privacy` に配置

### テーブル設計 (確定)

```
┌─────────────────┐
│     users       │
├─────────────────┤
│ id        UUID  │  PK
│ email     TEXT  │  UNIQUE
│ name      TEXT  │
│ image     TEXT  │  nullable
│ created_at      │
│ updated_at      │
│ deleted_at      │  nullable
└────────┬────────┘
         │
         │ 1:N
         ▼
┌─────────────────┐
│     goals       │
├─────────────────┤
│ id        UUID  │  PK
│ user_id   UUID  │  FK → users
│ title     TEXT  │
│ description     │  nullable
│ status    ENUM  │  active / archived
│ created_at      │
│ updated_at      │
│ deleted_at      │  nullable
└────────┬────────┘
         │
         │ 1:N
         ▼
┌─────────────────────┐
│    reflections      │
├─────────────────────┤
│ id          UUID    │  PK
│ goal_id     UUID    │  FK → goals
│ good        TEXT    │  nullable
│ bad         TEXT    │  nullable
│ analysis    TEXT    │  nullable
│ next_action TEXT    │  nullable
│ date        DATE    │  振り返り対象日
│ created_at          │
│ updated_at          │
│ deleted_at          │  nullable
└─────────────────────┘
```

### 設計方針

- テーブル名・カラム名: スネークケース
- テーブル名: 複数形
- id: UUID
- 論理削除: deleted_at で管理
- status: enum (active / archived)
- date: 振り返り対象日 (created_at とは別に保持、書き忘れ対応のため)

### UI ライブラリ

- shadcn/ui を採用

### 画面構成 (MVP)

| パス       | 画面                 | 説明                                        |
| ---------- | -------------------- | ------------------------------------------- |
| /login     | ログイン             | Google ログインボタンのみ                   |
| /dashboard | ダッシュボード       | 目標一覧 + 各目標に紐づく振り返り履歴・入力 |
| /privacy   | プライバシーポリシー | 静的ページ                                  |

---

## 作業ログ

### 初期セットアップ

- [x] Next.js プロジェクト作成 (TypeScript + Tailwind + App Router)
- [x] ESLint / Prettier 設定
- [x] Husky + lint-staged 設定
- [x] .nvmrc 作成 (Node.js 24.13.0)
- [x] Prisma セットアップ (スキーマ定義完了)
- [x] NextAuth.js + Google ログイン設定
- [x] shadcn/ui セットアップ

### ページ実装

- [x] ログインページ (/login) 実装
- [x] ダッシュボードページ (/dashboard) 実装
- [x] プライバシーポリシーページ (/privacy) 実装
- [x] トップページ (/) - ログイン状態でリダイレクト

### 機能実装

- [x] DB マイグレーション実行 (prisma/migrations/20260127124743_init)
- [x] 目標 CRUD 機能実装 (Server Actions)
- [x] 振り返り CRUD 機能実装 (Server Actions)
- [x] 目標追加モーダル (GoalFormDialog)
- [x] 振り返り入力モーダル (ReflectionFormDialog)
- [x] 目標カードコンポーネント (GoalCard)

### Prisma 7 対応

- Prisma 7 では datasource URL を PrismaClient に渡す方法が変更
- better-sqlite3 アダプタ (@prisma/adapter-better-sqlite3) を使用して解決

### 現在の状態

- dev サーバー起動済み (http://localhost:3000)
- /login ページは表示される
- Google OAuth 未設定のため「アクセスをブロック: 認証エラーです」が表示される

### 次のステップ

- [ ] Google OAuth 設定 (Google Cloud Console)
- [ ] 動作確認
- [ ] Turso 連携 (本番用)
- [ ] Vercel デプロイ設定

---

## Google OAuth 設定手順

1. [Google Cloud Console](https://console.cloud.google.com/) にアクセス
2. プロジェクト作成 (または既存のを選択)
3. 「API とサービス」→「認証情報」
4. 「認証情報を作成」→「OAuth クライアント ID」
5. アプリケーションの種類: 「ウェブアプリケーション」
6. 承認済みリダイレクト URI に追加:
   ```
   http://localhost:3000/api/auth/callback/google
   ```
7. クライアント ID とシークレットをコピー

### .env 設定

```bash
# AUTH_SECRET を生成
openssl rand -base64 32
```

```env
AUTH_SECRET="生成した値"
GOOGLE_CLIENT_ID="取得したクライアントID"
GOOGLE_CLIENT_SECRET="取得したシークレット"
```
