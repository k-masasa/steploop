// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// 目標のステータス
enum GoalStatus {
  active
  archived
}

// ユーザー
model User {
  id         String    @id @default(uuid())
  email      String    @unique
  name       String
  image      String?
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  deleted_at DateTime?

  // Relations
  goals Goal[]

  @@map("users")
}

// 目標
model Goal {
  id          String     @id @default(uuid())
  user_id     String
  title       String
  description String?
  color       String     @default("blue") // テーマカラー: blue, green, purple, orange, pink, cyan
  status      GoalStatus @default(active)
  created_at  DateTime   @default(now())
  updated_at  DateTime   @updatedAt
  deleted_at  DateTime?

  // Relations
  user        User         @relation(fields: [user_id], references: [id], onDelete: Cascade)
  reflections Reflection[]

  @@index([user_id])
  @@map("goals")
}

// 振り返り
model Reflection {
  id          String    @id @default(uuid())
  goal_id     String
  good        String    // 必須: やったこと・うまくいったこと
  bad         String?
  analysis    String?
  next_action String?
  date        DateTime  // 振り返り対象日
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt
  deleted_at  DateTime?

  // Relations
  goal Goal @relation(fields: [goal_id], references: [id], onDelete: Cascade)

  @@index([goal_id])
  @@index([goal_id, date])
  @@map("reflections")
}
